<!doctype html><html><head><title>Quotas</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css><link rel=icon type=image/png href=/images/site/logo_hu46080cd0c725e203453795b794b5609d_25299_42x0_resize_box_2.png><link rel=stylesheet href=/css/style.css><meta name=description content="Quotas"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/logo_hu46080cd0c725e203453795b794b5609d_25299_42x0_resize_box_2.png alt=Logo>Henzel Moras</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/site/logo_hu46080cd0c725e203453795b794b5609d_25299_42x0_resize_box_2.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/logo_hu46080cd0c725e203453795b794b5609d_25299_42x0_resize_box_2.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=https://henzelmoras.github.io/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/linux-sys-admin/>Linux Sys Admin</a><ul class=active><li><a href=/posts/linux-sys-admin/lab-setup/>Lab Setup</a></li><li><a href=/posts/linux-sys-admin/linux-virtual-filesystem/>Linux Virtual Filesystem</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/linux-sys-admin/basic-storage-management/>Basic Storage Partition</a><ul><li><a href=/posts/linux-sys-admin/basic-storage-management/why-disk-partition/>Why Disk Partition ?</a></li><li><a href=/posts/linux-sys-admin/basic-storage-management/storage-overview/>Storage Overview</a></li><li><a href=/posts/linux-sys-admin/basic-storage-management/disk-types/>Disk Types</a></li><li><a href=/posts/linux-sys-admin/basic-storage-management/interacting-with-disks/>Interacting With Disks</a></li><li><a href=/posts/linux-sys-admin/basic-storage-management/disk-partition/>Disk Partition</a></li><li><a href=/posts/linux-sys-admin/basic-storage-management/backup-partition/>Backup Partition</a></li><li><a href=/posts/linux-sys-admin/basic-storage-management/file-as-disk/>File As Disk</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/linux-sys-admin/advanced-storage-managment/>Advanced Storage Partition</a><ul class=active><li><a href=/posts/linux-sys-admin/advanced-storage-managment/logical-volume-manager/>LVM</a></li><li><a href=/posts/linux-sys-admin/advanced-storage-managment/raid/>RAID</a></li><li><a href=/posts/linux-sys-admin/advanced-storage-managment/swap/>swap</a></li><li><a class=active href=/posts/linux-sys-admin/advanced-storage-managment/quotas/>Quotas</a></li><li><a href=/posts/linux-sys-admin/advanced-storage-managment/encryption/>Encryption</a></li></ul></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://henzelmoras.github.io/posts/linux-sys-admin/advanced-storage-managment/quotas/images/work.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/site/default-avatar.png alt="Author Image"><h5 class=author-name>Henzel Moras</h5><p>April 18, 2021</p></div><div class=title><h1>Quotas</h1></div><div class=post-content id=post-content><h3 id=filesystem-quotas><strong>Filesystem Quotas</strong></h3><p>Linux can use and enforce quotas on filesystems. Disk quotas allow administrators to control the maximum space particular users (or groups) are allowed. Considerable flexibility is allowed and quotas can be assigned on a per filesystem basis. Protection is provided against a subset of users exhausting collective resources.</p><h3 id=utilities>Utilities</h3><details><summary>quotacheck</summary><p>quotacheck generates and updates quota accounting files.</p></details><details><summary>quotaon</summary><p>quotaon enables quota accounting.</p></details><details><summary>quotaoff</summary><p>quotaoff disables quota accounting.</p></details><details><summary>edquota</summary><p>edquota used for editing user or group quotas.</p></details><details><summary>quota</summary><p>quota reports on usage and limits.</p></details><p>Quota operations require the existence of the files <strong>aquota.user</strong> and <strong>aquota.group</strong> in the root directory of the filesystem using quotas.</p><p>Quotas may be enabled or disabled on a per-filesystem basis. In addition, Linux supports the use of quotas based on user and group IDs.</p><p>Different filesystem types may have additional quota-related utilities, such as <strong>xfs_quota</strong>.</p><h3 id=steps>Steps</h3><ol><li>Mount the filesystem with user and/or group quota options:Add the <strong>usrquota</strong> and/or <strong>grpquota</strong> options to the filesystems entry in <strong>/etc/fstab</strong>Remount the filesystem (or mount it if new)</li><li>Run <strong>quotacheck</strong> on the filesystem to set up quotas</li><li>Enable quotas on the filesystem</li><li>Set quotas with the <strong>edquota</strong> program.</li></ol><h3 id=1-userquota-in-fstab>1. Userquota in Fstab</h3><p>in this example we will use a file as disk and add quota settings within /etc/fstab</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>imagefile bs<span style=color:#f92672>=</span>1M count<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span>
1024+0 records in
1024+0 records out
<span style=color:#ae81ff>1073741824</span> bytes <span style=color:#f92672>(</span>1.1 GB, 1.0 GiB<span style=color:#f92672>)</span> copied, 1.0488 s, 1.0 GB/s

<span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ mkfs.ext4 imagefile 
mke2fs 1.45.6 <span style=color:#f92672>(</span>20-Mar-2020<span style=color:#f92672>)</span>
Discarding device blocks: <span style=color:#66d9ef>done</span>                            
Creating filesystem with <span style=color:#ae81ff>262144</span> 4k blocks and <span style=color:#ae81ff>65536</span> inodes
Filesystem UUID: e9b2993f-b882-404b-8692-d411c8e1adb6
Superblock backups stored on blocks: 
	32768, 98304, 163840, <span style=color:#ae81ff>229376</span>

Allocating group tables: <span style=color:#66d9ef>done</span>                            
Writing inode tables: <span style=color:#66d9ef>done</span>                            
Creating journal <span style=color:#f92672>(</span><span style=color:#ae81ff>8192</span> blocks<span style=color:#f92672>)</span>: <span style=color:#66d9ef>done</span>
Writing superblocks and filesystem accounting information: <span style=color:#66d9ef>done</span>

<span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ sudo nano /etc/fstab                                                                                                                                                                                  
<span style=color:#75715e>#</span>
<span style=color:#75715e># /etc/fstab</span>
<span style=color:#75715e># Created by anaconda on Thu Nov 12 19:37:28 2020</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># Accessible filesystems, by reference, are maintained under &#39;/dev/disk/&#39;.</span>
<span style=color:#75715e># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># After editing this file, run &#39;systemctl daemon-reload&#39; to update systemd</span>
<span style=color:#75715e># units generated from this file.</span>
<span style=color:#75715e>#</span>
/dev/mapper/cl-root     /                       xfs     defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>
UUID<span style=color:#f92672>=</span>03f520f5-2aec-411c-a15b-3e2f62ffc37c /boot ext4    defaults        <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>
/dev/mapper/cl-swap     swap                    swap    defaults        <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>

/home/s0x45ker/imagefile /mnt                   ext4    loop,usrquota   <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span>
</code></pre></div><p>finally mount em</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ sudo mount -a
<span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ df -Th | grep mnt
/dev/loop0          ext4      976M  2.6M  907M   1% /mnt
</code></pre></div><h3 id=2-setup-quota>2. Setup quota</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ sudo quotacheck -u /mnt/
</code></pre></div><h3 id=3-enable-quota>3. Enable quota</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ sudo quotaon -u /mnt/
</code></pre></div><p>might need to change ownership so that we can exhust quotas as that user</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ sudo quotaon -u /mnt/

<span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ ls -al / | grep mnt
drwxr-xr-x.   <span style=color:#ae81ff>3</span> s0x45ker s0x45ker <span style=color:#ae81ff>4096</span> Apr <span style=color:#ae81ff>18</span> 16:33 mnt
</code></pre></div><h3 id=4--set-quota>4. Set Quota</h3><p><code>soft limit : 200</code> which can be exceeded but will show a warning</p><p><code>hard limt : 600</code> which will stop the operation if size exceeds</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin ~<span style=color:#f92672>]</span>$ sudo edquota -u s0x45ker
Disk quotas <span style=color:#66d9ef>for</span> user s0x45ker <span style=color:#f92672>(</span>uid 1001<span style=color:#f92672>)</span>:
  Filesystem                   blocks       soft       hard     inodes     soft     hard
  /dev/loop0                      <span style=color:#ae81ff>600</span>        <span style=color:#ae81ff>200</span>        <span style=color:#ae81ff>600</span>          <span style=color:#ae81ff>4</span>        <span style=color:#ae81ff>0</span>        <span style=color:#ae81ff>0</span>
</code></pre></div><p>ok so now lets put our user <code>s0x45ker</code> quotas to the test</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin /mnt<span style=color:#f92672>]</span>$ dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>file bs<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>
loop0: warning, user block quota exceeded.
200+0 records in
200+0 records out
<span style=color:#ae81ff>204800</span> bytes <span style=color:#f92672>(</span><span style=color:#ae81ff>205</span> kB, <span style=color:#ae81ff>200</span> KiB<span style=color:#f92672>)</span> copied, 0.00263448 s, 77.7 MB/s

<span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin /mnt<span style=color:#f92672>]</span>$ sudo quota s0x45ker
Disk quotas <span style=color:#66d9ef>for</span> user s0x45ker <span style=color:#f92672>(</span>uid 1001<span style=color:#f92672>)</span>: 
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
     /dev/loop0     204*    <span style=color:#ae81ff>200</span>     <span style=color:#ae81ff>600</span>   6days       <span style=color:#ae81ff>2</span>       <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>0</span>        

<span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin /mnt<span style=color:#f92672>]</span>$ dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>file1 bs<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>
200+0 records in
200+0 records out
<span style=color:#ae81ff>204800</span> bytes <span style=color:#f92672>(</span><span style=color:#ae81ff>205</span> kB, <span style=color:#ae81ff>200</span> KiB<span style=color:#f92672>)</span> copied, 0.00249903 s, 82.0 MB/s
<span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin /mnt<span style=color:#f92672>]</span>$ sudo quota s0x45ker
Disk quotas <span style=color:#66d9ef>for</span> user s0x45ker <span style=color:#f92672>(</span>uid 1001<span style=color:#f92672>)</span>: 
     Filesystem  blocks   quota   limit   grace   files   quota   limit   grace
     /dev/loop0     404*    <span style=color:#ae81ff>200</span>     <span style=color:#ae81ff>600</span>   6days       <span style=color:#ae81ff>3</span>       <span style=color:#ae81ff>0</span>       <span style=color:#ae81ff>0</span>        

<span style=color:#f92672>[</span>s0x45ekr--_<span style=color:#f92672>(</span>+_+<span style=color:#f92672>)</span>_--Sysadmin /mnt<span style=color:#f92672>]</span>$ dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>file2 bs<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>
loop0: write failed, user block limit reached.
dd: error writing <span style=color:#e6db74>&#39;file2&#39;</span>: Disk quota exceeded
197+0 records in
196+0 records out
<span style=color:#ae81ff>200704</span> bytes <span style=color:#f92672>(</span><span style=color:#ae81ff>201</span> kB, <span style=color:#ae81ff>196</span> KiB<span style=color:#f92672>)</span> copied, 0.000840477 s, <span style=color:#ae81ff>239</span> MB/s
</code></pre></div><p>as u can see the file operatition stops when it exceeds hard limit</p></div><div class=btn-improve-page><a href=https://github.com/HenzelMoras/HenzelMoras.github.io/edit/source/content/posts/linux-sys-admin/advanced-storage-managment/quotas/index.md target=_blank><i class="fas fa-code-branch"></i>Improve this page</a></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/linux-sys-admin/advanced-storage-managment/logical-volume-manager/ class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i>Prev</div><div class=next-prev-text>Logical Volume Manager</div></a></div><div class="col-md-6 next-article"><a href=/posts/linux-sys-admin/advanced-storage-managment/raid/ class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>RAID</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#filesystem-quotas><strong>Filesystem Quotas</strong></a></li><li><a href=#utilities>Utilities</a></li><li><a href=#steps>Steps</a></li><li><a href=#1-userquota-in-fstab>1. Userquota in Fstab</a></li><li><a href=#2-setup-quota>2. Setup quota</a></li><li><a href=#3-enable-quota>3. Enable quota</a></li><li><a href=#4--set-quota>4. Set Quota</a></li></ul></li></ul></nav></div></div></section></div><footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=#about>About</a></li><li class=nav-item><a class=smooth-scroll href=#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=#accomplishments>Accomplishments</a></li><li class=nav-item><a class=smooth-scroll href=#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><span>Email:</span> <span>henzelmoras@gmail.com</span></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form><div class=form-group><input type=email class=form-control id=exampleInputEmail1 aria-describedby=emailHelp placeholder="Enter email">
<small id=emailHelp class="form-text text-muted">We'll never share your email with anyone else.</small></div><button type=submit class="btn btn-info">Submit</button></form></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=#home target=#><img src=/images/site/logo_hu46080cd0c725e203453795b794b5609d_25299_32x0_resize_box_2.png>
Henzel Moras</a></div><div class="col-md-4 text-center">© 2021 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a>
<a id=theme href=https://github.com/hossainemruz/toha target=#><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png>
Toha</a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>